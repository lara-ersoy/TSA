import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from scipy import stats

# (e)
# Check for normality of the fitted residuals

df_fit = pd.read_csv("ar2_fit_from_d.csv")
residuals = df_fit["residuals"].dropna().values

# Histogram + density 
plt.figure(figsize=(8, 5))

# Histogram
plt.hist(residuals, bins=50, density=True, color="#89CFF0", alpha=0.7)

# Density curve
x = np.linspace(residuals.min(), residuals.max(), 400)
kde = stats.gaussian_kde(residuals)
plt.plot(x, kde(x), color="#FF00FF", linewidth=2)

plt.title("Residuals histogram + density")
plt.xlabel("Residuals")
plt.ylabel("Density")
plt.tight_layout()
plt.savefig("residuals_histogram.png", dpi=200)
plt.show()


# QQ plot
plt.figure(figsize=(8, 5))

(osm, osr), (slope, intercept, r) = stats.probplot(residuals, dist="norm")
plt.scatter(osm, osr, color="#800080") 
plt.plot(osm, slope * osm + intercept, color="#FF69B4", linewidth=2)  

plt.title("Normal QQ plot of residuals")
plt.xlabel("Theoretical Quantiles")
plt.ylabel("Sample Quantiles")
plt.tight_layout()
plt.savefig("residuals_qqplot.png", dpi=200)
plt.show()
